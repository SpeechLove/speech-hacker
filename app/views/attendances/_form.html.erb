<% if @meeting.meeting_date >= DateTime.now %>
  <h2>Meeting Sign-up</h2>
<% else %>
  <h2>Meeting agenda</h2>
<% end %>

<%= form_for @attendance do |f| %>
  <div class="control-group">
      <%= f.label "Will you attend this meeting?", nil, :class => 'control-label' %>
      <div class="controls">
        <label class="radio">
            <% if @user_attending %>
              <%= f.radio_button "attend", "true", :class => "attend-option", :checked => true %>
            <% else %>
              <%= f.radio_button "attend", "true", :class => "attend-option", :checked => false %>
            <% end %>
            <%= f.label :attend_true, 'Yes' %>
        </label>
        <label class="radio">
          <% if @user_attending %>
            <%= f.radio_button "attend", "false", :class => "attend-option", :checked => false %>
          <% else %>
            <%= f.radio_button "attend", "false", :class => "attend-option", :checked => true %>
          <% end %>
          <%= f.label :attend_false, 'No' %>
        </label>
    </div>
  </div>

  <div class="control-group">
    <hr class="bs-docs-separator">
    <%= label_tag "Sign up for a role", nil, :class => 'control-label' %>
    <div class="controls">
      <% @meeting_roles.each do |role| %>
        <label class="radio">
          <%= f.radio_button :meeting_role_id, role.id, :class => "#{role.title}-option role-option" %>
          <%= label role.title, role.title  %>

          <% if role.speaker? %>
            <div class="speech-fields">
              <%= f.fields_for :meeting, @attendance.meeting do |m|%>
                <%= m.fields_for :speeches, @attendance.meeting.speeches.build do |speech_fields| %>
                  Speech Title: <%= speech_fields.text_field :title, :class => "speech-title" %>
                  Project: <%= speech_fields.collection_select :project_id, Project.all, :id, :name%>
                  <%= speech_fields.hidden_field :user_id, :value => current_user.id %>
                <% end %>
              <% end %>
            </div>
          <% end %>
        </label>
      <% end %>
    </div>
  </div>

  <hr class="bs-docs-separator">

  <%= hidden_field_tag :meeting_id, @meeting.id %>

  <%= f.submit nil, :class => "btn btn-primary" %>
<% end %>

